package org.hammerlab.bam.check

import org.hammerlab.bam.check.Error.CountsWrapper
import org.hammerlab.spark.test.suite.SparkSuite
import org.hammerlab.test.resources.File

class CheckBAMTest
  extends SparkSuite {

  test("2.bam") {
    val Result(
      numPositions,
      calls,
      numFalseCalls,
      falseCalls,
      criticalErrorCounts,
      totalErrorCounts,
      _
    ) =
      Main.run(
        sc,
        Args(
          File("2.bam"),
          numBlocks = Some(100)
        )
      )

    numPositions should be(6549800)

    numFalseCalls should be(0)

    println(criticalErrorCounts.pp())

    println(totalErrorCounts.pp(wrapFields = true))

    totalErrorCounts should be(
      ErrorT[Long](
        invalidCigarOp              = 6168038,
        tooLargeReadIdx             = 6027725,
        tooLargeNextReadIdx         = 6027725,
        tooFewRemainingBytesImplied = 5769355,
        nonNullTerminatedReadName   = 5134158,
        nonASCIIReadName            =  685293,
        noReadName                  =  641496,
        negativeReadPos             =  333781,
        negativeReadIdx             =  333781,
        negativeNextReadPos         =  333781,
        negativeNextReadIdx         =  333781,
        emptyReadName               =   51823,
        tooLargeReadPos             =   43922,
        tooLargeNextReadPos         =   43922,
        tooFewBytesForCigarOps      =   42542,
        tooFewFixedBlockBytes       =       0,
        tooFewBytesForReadName      =       0
      )
    )
  }

  /*

  original 1.bam false positive: 268458108:115

  1.bam
  29890275308 positions
  0 false
  1:
	ErrorT(35,0,0,0,0,0,0,0,0,0,11,0,0,416,0,0,0)
	ErrorT(35,0,0,0,0,0,0,0,0,0,11,0,0,416,0,0,0)
2:
	ErrorT(0,1,1939,0,0,0,382642,0,0,2,920149,1571,4759093,251402,490776,5811555,10586)
	ErrorT(35,1,1939,0,0,0,382642,0,0,2,920160,1571,4759093,251818,490776,5811555,10586)
3:
	ErrorT(0,2927551,395152647,100829,132323,49798673,392970310,66696,173825,65,375519161,11367335,153709907,407817,49254476,200419646,5186537)
	ErrorT(35,2927552,395154586,100829,132323,49798673,393352952,66696,173825,67,376439321,11368906,158469000,659635,49745252,206231201,5197123)
4:
	ErrorT(0,108671434,2952079171,24277567,19472408,244647973,2777046155,18620524,18223717,3,2024777872,42883023,841284084,165041140,141539601,2267277497,967871151)
	ErrorT(35,111598986,3347233757,24378396,19604731,294446646,3170399107,18687220,18397542,70,2401217193,54251929,999753084,165700775,191284853,2473508698,973068274)
5:
	ErrorT(0,1027496521,22679797319,201873001,22906271,862535443,22838509229,315935536,24201584,3,20321829545,2223741734,1149343591,53866326,49058671,23607959367,23368418549)
	ErrorT(35,1139095507,26027031076,226251397,42511002,1156982089,26008908336,334622756,42599126,73,22723046738,2277993663,2149096675,219567101,240343524,26081468065,24341486823)
6:
	ErrorT(0,409391530,1733895920,1159113184,584169,385769651,1757753957,1050741825,496045,0,1968532903,40862403,122249833,12393341,4664106,2137797990,2079984071)
	ErrorT(35,1548487037,27760926996,1385364581,43095171,1542751740,27766662293,1385364581,43095171,73,24691579641,2318856066,2271346508,231960442,245007630,28219266055,26421470894)
7:
	ErrorT(0,33943016,163122456,197065472,0,39678313,157387159,197065472,0,0,194086390,1997085,540617,441380,0,197065472,197065472)
	ErrorT(35,1582430053,27924049452,1582430053,43095171,1582430053,27924049452,1582430053,43095171,73,24885666031,2320853151,2271887125,232401822,245007630,28416331527,26618536366)

  2.bam
  37676338093 positions
  0 false
  1:
	ErrorT(35,0,0,0,0,0,0,0,0,0,2,0,0,402,0,0,0)
	ErrorT(35,0,0,0,0,0,0,0,0,0,2,0,0,402,0,0,0)
2:
	ErrorT(0,5,832,0,0,0,461578,0,0,1,633719,343,3863268,219964,235137,4928975,13932)
	ErrorT(35,5,832,0,0,0,461578,0,0,1,633721,343,3863268,220366,235137,4928975,13932)
3:
	ErrorT(0,2547073,459271079,104611,113305,57097280,458230132,51448,202221,77,437488856,11743503,178954271,507968,56074924,232057588,5897258)
	ErrorT(35,2547078,459271911,104611,113305,57097280,458691710,51448,202221,78,438122577,11743846,182817539,728334,56310061,236986563,5911190)
4:
	ErrorT(0,125582388,4739260604,24493331,19117259,295354339,4519968387,19334181,18924175,3,3360207405,195554274,1194098180,198532501,160645570,3918686127,1066647576)
	ErrorT(35,128129466,5198532515,24597942,19230564,352451619,4978660097,19385629,19126396,81,3798329982,207298120,1376915719,199260835,216955631,4155672690,1072558766)
5:
	ErrorT(0,1217652049,27903510134,232708829,24985791,1013603535,28103158229,377936790,24919424,0,25071354437,2682953456,1247610493,162754506,56775880,28995340273,28712200149)
	ErrorT(35,1345781515,33102042649,257306771,44216355,1366055154,33081818326,397322419,44045820,81,28869684419,2890251576,2624526212,362015341,273731511,33151012963,29784758915)
6:
	ErrorT(0,497802968,2056739955,1386541085,525033,469642311,2084851296,1246525437,695568,0,2348820892,44477493,146956735,14959548,4762095,2549326007,2478661669)
	ErrorT(35,1843584483,35158782604,1643847856,44741388,1835697465,35166669622,1643847856,44741388,81,31218505311,2934729069,2771482947,376974889,278493606,35700338970,32263420584)
7:
	ErrorT(0,42588556,199736627,242325183,0,50475574,191849609,242325183,0,0,233706997,7643728,519063,455395,0,242325183,242325183)
	ErrorT(35,1886173039,35358519231,1886173039,44741388,1886173039,35358519231,1886173039,44741388,81,31452212308,2942372797,2772002010,377430284,278493606,35942664153,32505745767)

   */

}
